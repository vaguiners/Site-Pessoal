<title>Vag's Filmes</title>
<style>
body {background-color:#181818;color:#a19d9d}
table {width:100%;border-collapse:collapse}
th {text-align:left}
tr:hover{background-color:#252525}
video {position:absolute;display:none;}
</style>
<video width="640" height="360" id="player" controls autoplay></video>
<table id="TabelaDeFilmes">
  <tr>
    <th>Filme</th>
    <th>Ano</th>
    <th>Score</th>
	<th>Duracao</th>
  </tr>
</table>

<script>
//Variáveis permanentes
Tabela = document.getElementById("TabelaDeFilmes");
Player = document.getElementById("player");
//Variáveis mutáveis
var SegurandoMouse = false;
//Obter json com o filmes e loopar em função para adicionar filmes a tabela
fetch('filmes.json').then(response => response.json()).then(json => json.forEach(AdicionarFilme))

//Funções
//Adição de filmes a tabela
function AdicionarFilme(filme) {
	var row = Tabela.insertRow();
	var cell1 = row.insertCell();
	var cell2 = row.insertCell();
	var cell3 = row.insertCell();
	var cell4 = row.insertCell();
	//Celula Nome
	cell1.innerHTML = filme.nome
	cell1.dataset.videoid=filme.videoid;
	cell1.style = "cursor:pointer";
	//Celula ano
	cell2.innerHTML = filme.ano;
	//Celula score
	cell3.innerHTML = filme.score.toFixed(1);
	cell3.style = "color:hsl("+filme.score.toFixed(1).replace(".", "")+", 70%, 30%);"
	//Celula duração
	cell4.innerHTML = filme.duracao;
}

function MoverPlayer() {
	console.log("testd");
}

//Registrar eventos do mouse sobre o player, para poder mover o player
Player.addEventListener('click', (e) => e.preventDefault() )
Player.addEventListener('mousedown', function(e) {SegurandoMouse = true;Player.controls = false;}, true);
Player.addEventListener('mouseup', function() {SegurandoMouse = false;Player.controls = true;}, true);
document.addEventListener('mousemove', function(event) {
	event.preventDefault();
	if (SegurandoMouse) {
	Player.style.left = event.clientX-320 + 'px';
	Player.style.top  = event.clientY-180 + 'px';
 }
}, true);

Tabela.addEventListener("click", function(event) {
	if (event.target.dataset.videoid) {
		console.log(event.target.dataset.videoid);
		Player.src="https://video.vaguiner.eu.org/"+event.target.dataset.videoid;
		Player.style.display = "block";
	}
});
</script>
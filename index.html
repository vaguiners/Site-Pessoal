<title>Vag's Filmes</title>
<style>
body {background-color:#181818;color:#a19d9d;overflow-x: hidden;}
table {width:100%;border-collapse:collapse}
th {text-align:left}
tr:hover{background-color:#252525}
video {position:absolute;display:none;}
#posterOverlay {position:absolute;pointer-events:none}
#divDescricao {position:absolute;pointer-events:none;left:200;}
#OverlayBackdrop {position:absolute;pointer-events:none;width:auto;height:300px;opacity:0.1;}
#OverlayDIV {pointer-events:none;width:733px;height:300px;position:absolute;overflow:hidden;display:none;}
input {color:#a19d9d;background:transparent;bottom:10;right:10;width:185px;position:absolute;display:none;pointer-events:none;border:0;}
</style>
<div id="OverlayDIV"><img width="200" height="300" id="posterOverlay"><div id="divDescricao"><img id="OverlayBackdrop">
<fieldset><legend>Arquivo</legend>Resolu&ccedil;&atilde;o armazenada: <a id="resolucaoArmazenada">0x0</a>. (Transmite em 360p) </fieldset>
<br>
<fieldset id="fieldsimilares"><legend>Similares</legend>
<table id="TabelaDeSimilares"></table>
</fieldset>
</div></div>
<input oninput="FiltrarTabela(this.value)" type="text" id="InputBusca">
<video width="640" height="360" id="player" controls autoplay preload="auto"></video>
<table id="TabelaDeFilmes">
  <tr>
    <th>Filme</th>
    <th>Ano</th>
    <th>Score</th>
	<th>Dura&ccedil;&atilde;o</th>
  </tr>
</table>

<script>
//Aviso de incompatibilidade com smartphones
if (/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)) {
	document.write("<h1 style=text-align:center;width:100%;background-color:orange>Site infuncional em celulares</h1>");
}

//Variáveis permanentes
Tabela = document.getElementById("TabelaDeFilmes");
fieldsimilares = document.getElementById("fieldsimilares");
TabelaDeSimilares = document.getElementById("TabelaDeSimilares");
Player = document.getElementById("player");
PosterOverlay = document.getElementById("posterOverlay");
OverlayDIV = document.getElementById("OverlayDIV");
divDescricao = document.getElementById("divDescricao");
InputBusca = document.getElementById("InputBusca");
resolucaoArmazenada = document.getElementById("resolucaoArmazenada");
//Variáveis mutáveis
var SegurandoMouse = false;
let oldValue = 0;

//Obter json com o filmes e loopar em função para adicionar filmes a tabela
fetch('filmes.json').then(response => response.json()).then(json => json.forEach(AdicionarFilme))

//Adição de filmes a tabela
function AdicionarFilme(filme) {
	var row = Tabela.insertRow();
	var cell1 = row.insertCell();
	var cell2 = row.insertCell();
	var cell3 = row.insertCell();
	var cell4 = row.insertCell();
	//Celula Nome
	cell1.innerHTML = filme.nome
	cell1.dataset.videoid=filme.videoid;
	cell1.dataset.poster=filme.poster;
	cell1.dataset.background=filme.background;
	cell1.dataset.resolucaoArmazenada=filme.resolucaoArmazenada;
	if (filme.similares) {cell1.dataset.similares=JSON.stringify(filme.similares)}
	cell1.style = "cursor:pointer";
	//Celula ano
	cell2.innerHTML = filme.ano;
	//Celula score
	cell3.innerHTML = filme.score.toFixed(1);
	cell3.style = "color:hsl("+filme.score.toFixed(1).replace(".", "")+", 70%, 30%);"
	//Celula duração
	cell4.innerHTML = filme.duracao;
}

//Função de filtro de tabela por input
function FiltrarTabela(filtro) {
	var tr, td, i, txtValue;
	tr = Tabela.getElementsByTagName("tr");
	for (i = 0; i < tr.length; i++) {
		td = tr[i].getElementsByTagName("td")[0];
		if (td) {
			txtValue = td.textContent || td.innerText;
			if (txtValue.toLowerCase().replace(/\s/g, '').normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-zA-Z0-9 ]/g, '').indexOf(filtro.toLowerCase().replace(/\s/g, '').normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-zA-Z0-9 ]/g, '')) > -1) {
				tr[i].style.display = "";
			} else {
				tr[i].style.display = "none";
			}
		}
	}
}
//Registrar eventos do mouse sobre o player, para poder mover o player
//Atalhos: Scroll no player para dar zoom, click no botão do meio do mouse no player para fechar o player e descarregar o vídeo
document.body.addEventListener('keypress', function(e) {
	InputBusca.style.display = "block";
	InputBusca.focus()
}, true);
Player.addEventListener('click', (e) => e.preventDefault())
Player.addEventListener('mousedown', function(e) {
	if(e.which == 1) {
		SegurandoMouse=true
		Player.controls=false
		offsetX=e.pageX-parseInt(window.getComputedStyle(this).left)
		offsetY=e.pageY-parseInt(window.getComputedStyle(this).top)
	}
	
	if(e.which == 2) {
		Player.src="";
		Player.style.display = "none";
	}
}, true);
Player.addEventListener('mouseup', function() {SegurandoMouse = false;Player.controls = true;}, true);
document.addEventListener('mousemove', function(event) {
	event.preventDefault();
	InputBusca.style.display = "none";
	if (event.target.dataset.poster) {
		TabelaDeSimilares.innerHTML = "";
		if (event.target.dataset.similares) {
			fieldsimilares.style.display = "block";
			tagssimilares = JSON.parse(event.target.dataset.similares)
			for (index in tagssimilares) {
				if (tagssimilares[index]) {
					if (tagssimilares[index].filme) {
					TabelaDeSimilares.innerHTML+= "<tr><td>"+tagssimilares[index].filme+"</td><td>"+tagssimilares[index].similaridade+" tags</td></tr>";
					}
				}
			}
		} else {
			fieldsimilares.style.display = "none";
		}
		posterOverlay.src=event.target.dataset.poster;
		OverlayDIV.style.left = event.pageX+10 + 'px';
		OverlayDIV.style.display = "block";
		OverlayBackdrop.src = event.target.dataset.background;
		resolucaoArmazenada.innerText=event.target.dataset.resolucaoArmazenada;
		if (window.innerHeight-event.clientY > 300) {
			OverlayDIV.style.top = event.pageY + 'px';
		} else {
			OverlayDIV.style.top = event.pageY-300 + 'px';
		}
		
	} else {
		OverlayDIV.style.display = "none";
	}
	if (SegurandoMouse) {
		Player.style.top = (event.pageY - offsetY) + 'px';
		Player.style.left = (event.pageX - offsetX) + 'px';
	}
}, true);

//Registro do evento para dar zoom no vídeo com scroll
Player.addEventListener('wheel', function(evt) {
	event.preventDefault();
	if (evt.deltaY < 0) {
		Player.width-=48
		Player.height-=27
	}
	if(evt.deltaY > 0)  {
		Player.width+=48
		Player.height+=27
	}
}, true);

//Abrir player ao clicar no filme
Tabela.addEventListener("click", function(event) {
	if (event.target.dataset.videoid) {
		Player.src="https://video.vaguiner.eu.org/?id="+event.target.dataset.videoid;
		Player.style.display = "block";
		Player.style.top = event.pageY + 'px';
		Player.style.left = event.pageX + 'px';
	}
});
</script>

<! -- O site termina aqui. Abaixo disso é lixo adicionado pelo Cloudflare -->

